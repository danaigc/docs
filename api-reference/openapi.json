{
  "openapi": "3.1.0",
  "info": {
    "title": "Egg API",
    "description": "AI Model Aggregation API for image and video generation",
    "version": "1.0.0",
    "contact": {
      "email": "support@eggapi.ai"
    }
  },
  "servers": [
    {
      "url": "https://api.eggapi.ai",
      "description": "Production"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/v1/generate": {
      "post": {
        "operationId": "generate",
        "summary": "Generate Content",
        "description": "Generate images or videos using AI models. Current models are asynchronous and return a task ID for polling (202 Accepted).",
        "tags": ["Generation"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GenerateRequest"
              },
              "examples": {
                "image": {
                  "summary": "Generate an image",
                  "value": {
                    "model": "nanobanana-pro",
                    "prompt": "A serene mountain landscape at sunset",
                    "aspect_ratio": "16:9",
                    "num_outputs": 1,
                    "webhook_url": "https://webhook.site/your-webhook-id"
                  }
                },
                "video": {
                  "summary": "Generate a video",
                  "value": {
                    "model": "veo3.1",
                    "prompt": "A cat playing with a ball of yarn",
                    "duration": 5,
                    "aspect_ratio": "16:9",
                    "webhook_url": "https://webhook.site/your-webhook-id"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Synchronous generation completed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenerateResponse"
                }
              }
            }
          },
          "202": {
            "description": "Async task created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient balance",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/tasks/{id}": {
      "get": {
        "operationId": "getTask",
        "summary": "Get Task",
        "description": "Retrieve the status and result of an async generation task.",
        "tags": ["Tasks"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Task ID (e.g., gen_abc123)",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Task details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskDetailResponse"
                },
                "examples": {
                  "failed": {
                    "summary": "Failed task",
                    "value": {
                      "data": {
                        "id": "gen_abc123def456",
                        "status": "failed",
                        "model": "nanobanana",
                        "type": "image_generate",
                        "error": "Content moderation: prompt contains prohibited content",
                        "cost": "$0.00",
                        "created_at": "2025-12-25T21:03:47.879577+08:00",
                        "started_at": "2025-12-25T21:03:50.000000+08:00",
                        "completed_at": "2025-12-25T21:04:10.000000+08:00"
                      },
                      "error": null
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Task not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/tasks": {
      "get": {
        "operationId": "listTasks",
        "summary": "List Tasks",
        "description": "Get a paginated list of your generation tasks.",
        "tags": ["Tasks"],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number (default: 1)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "description": "Items per page (default: 20, max: 100)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of tasks",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/usage": {
      "get": {
        "operationId": "listUsage",
        "summary": "List Usage",
        "description": "Get a paginated list of your API usage records.",
        "tags": ["Usage"],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number (default: 1)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "description": "Items per page (default: 20, max: 100)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of usage records",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UsageListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/v1/usage/summary": {
      "get": {
        "operationId": "getUsageSummary",
        "summary": "Usage Summary",
        "description": "Get aggregated usage statistics grouped by model.",
        "tags": ["Usage"],
        "responses": {
          "200": {
            "description": "Usage summary by model",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UsageSummaryResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flow/v1/images/edits": {
      "post": {
        "operationId": "imageEdit",
        "summary": "Edit Images",
        "description": "Edit images using AI models with natural language prompts. Supports up to 9 images per request. Processing is asynchronous - returns a task ID for polling.",
        "tags": ["Image Editing"],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/ImageEditRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Async task created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Task created",
                    "value": {
                      "data": {
                        "id": "edit_abc123def456",
                        "status": "pending",
                        "model": "nano_banana",
                        "type": "image_edit",
                        "cost": "$0.00",
                        "created_at": "2025-12-26T10:30:00.000000+08:00"
                      },
                      "error": null
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient balance",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "API Key authentication. Get your key from the dashboard."
      }
    },
    "schemas": {
      "GenerateRequest": {
        "type": "object",
        "required": ["model", "prompt"],
        "properties": {
          "model": {
            "type": "string",
            "enum": ["veo3.1", "nanobanana", "nanobanana-pro"],
            "description": "The model to use for generation"
          },
          "prompt": {
            "type": "string",
            "minLength": 1,
            "maxLength": 2000,
            "description": "The prompt describing what to generate"
          },
          "negative_prompt": {
            "type": "string",
            "maxLength": 1000,
            "description": "What to avoid in the generation"
          },
          "num_outputs": {
            "type": "integer",
            "minimum": 1,
            "maximum": 4,
            "default": 1,
            "description": "Number of images to generate"
          },
          "duration": {
            "type": "integer",
            "minimum": 1,
            "maximum": 60,
            "description": "Video duration in seconds (for video models)"
          },
          "aspect_ratio": {
            "type": "string",
            "enum": ["16:9", "9:16"],
            "description": "Aspect ratio for image or video generation (default: 16:9)"
          },
          "image_url": {
            "type": "string",
            "format": "uri",
            "description": "Reference image URL for image-to-image/video"
          },
          "webhook_url": {
            "type": "string",
            "format": "uri",
            "maxLength": 2048,
            "description": "Webhook URL to receive async task notifications"
          }
        }
      },
      "ImageEditRequest": {
        "type": "object",
        "required": ["model", "prompt"],
        "properties": {
          "model": {
            "type": "string",
            "enum": ["nano_banana", "nano_banana_pro"],
            "description": "The model to use for image editing (note: use underscores)"
          },
          "prompt": {
            "type": "string",
            "minLength": 1,
            "maxLength": 2000,
            "description": "Description of how to edit the image"
          },
          "image[]": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "binary"
            },
            "maxItems": 9,
            "description": "Image files to edit (max 9). Use this OR image_url[]."
          },
          "image_url[]": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uri"
            },
            "maxItems": 9,
            "description": "URLs of images to edit (max 9). Use this OR image[]."
          },
          "webhook_url": {
            "type": "string",
            "format": "uri",
            "maxLength": 2048,
            "description": "Webhook URL to receive async task notifications"
          }
        }
      },
      "GenerateResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Generation ID"
              },
              "model": {
                "type": "string",
                "description": "Model used"
              },
              "urls": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "Generated content URLs"
              },
              "cost": {
                "type": "string",
                "description": "Total cost (e.g., '$0.0160')"
              }
            }
          },
          "error": {
            "type": "null"
          }
        }
      },
      "TaskResponse": {
        "type": "object",
        "properties": {
          "data": {
            "$ref": "#/components/schemas/Task"
          },
          "error": {
            "type": "null"
          }
        }
      },
      "TaskDetailResponse": {
        "type": "object",
        "properties": {
          "data": {
            "$ref": "#/components/schemas/Task"
          },
          "error": {
            "type": "null"
          }
        }
      },
      "Task": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Task ID (e.g., gen_abc123)"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "processing", "completed", "failed"],
            "description": "Current task status"
          },
          "model": {
            "type": "string",
            "description": "Model used"
          },
          "type": {
            "type": "string",
            "enum": ["video_generate", "image_generate", "image_edit"],
            "description": "Generation type"
          },
          "output": {
            "type": "object",
            "nullable": true,
            "properties": {
              "url": {
                "type": "string",
                "format": "uri",
                "description": "Generated content URL"
              },
              "duration_seconds": {
                "type": "integer",
                "description": "Video duration (for videos)"
              },
              "width": {
                "type": "integer"
              },
              "height": {
                "type": "integer"
              }
            }
          },
          "error": {
            "type": "string",
            "nullable": true,
            "description": "Error message if failed"
          },
          "cost": {
            "type": "string",
            "description": "Total cost"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "started_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "completed_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        }
      },
      "TaskListResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "properties": {
              "items": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Task"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          },
          "error": {
            "type": "null"
          }
        }
      },
      "UsageRecord": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "task_id": {
            "type": "string",
            "nullable": true
          },
          "model": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["image", "video"]
          },
          "units": {
            "type": "number",
            "description": "Number of units consumed"
          },
          "unit_cost": {
            "type": "string",
            "description": "Cost per unit"
          },
          "total_cost": {
            "type": "string",
            "description": "Total cost"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "UsageListResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "properties": {
              "items": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/UsageRecord"
                }
              },
              "pagination": {
                "$ref": "#/components/schemas/Pagination"
              }
            }
          },
          "error": {
            "type": "null"
          }
        }
      },
      "UsageSummary": {
        "type": "object",
        "properties": {
          "model": {
            "type": "string"
          },
          "total_units": {
            "type": "number"
          },
          "total_cost": {
            "type": "string"
          },
          "request_count": {
            "type": "integer"
          }
        }
      },
      "UsageSummaryResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UsageSummary"
            }
          },
          "error": {
            "type": "null"
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer"
          },
          "per_page": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "total_pages": {
            "type": "integer"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "null"
          },
          "error": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "enum": [
                  "BAD_REQUEST",
                  "VALIDATION_ERROR",
                  "UNAUTHORIZED",
                  "FORBIDDEN",
                  "INSUFFICIENT_BALANCE",
                  "NOT_FOUND",
                  "RATE_LIMITED",
                  "INTERNAL_ERROR",
                  "UPSTREAM_ERROR"
                ],
                "description": "Error code"
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              }
            },
            "required": ["code", "message"]
          }
        }
      }
    }
  }
}
